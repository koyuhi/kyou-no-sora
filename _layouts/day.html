<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ page.title }} - {{ site.title }}</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/reset.css" />
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css" />
    <!-- å¿…è¦ãªã‚‰ Vue ã® CDN ã‚‚ã“ã“ã§èª­ã¿è¾¼ã‚€ -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v6.7.2/css/all.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&family=Noto+Sans+JP:wght@100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="days">
    <header>
      <div class="wrapper">
        <div class="header-title">
          <a href="{{ site.baseurl }}/">{{ site.title }}</a>
        </div>
      </div>
    </header>
    <main>
      <div class="wrapper">
        <div id="app">
          <h1><span v-text="formattedDate"></span>ã®ç©ºã‚‚ã‚ˆã†</h1>

          <!-- åŒ—ãƒ»æ±ãƒ»å—ãƒ»è¥¿ ãƒœã‚¿ãƒ³ -->
          <nav class="direction-nav">
            <a
              v-for="d in directions"
              @click="currentDir = d"
              v-text="d"
              :class="{ active: currentDir === d }"
              ><span>{{ d }}</span></a
            >
          </nav>

          <!-- ç”»åƒè¡¨ç¤º -->
          <div v-if="currentDir && date">
            <h2>{{ currentDir }}</h2>
            <img :src="getPhotoUrl(currentDir)" :alt="currentDir" />
          </div>
          <p class="right" v-text="currentDir + 'ã®ãã‚‰'"></p>
          <!-- ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º -->
          <div v-if="comment">
            <h3>ä»Šæ—¥ã®ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
            <p v-text="comment"></p>
          </div>

          <!-- æ°—åœ§é…ç½®å›³è¡¨ç¤º -->
          <div v-if="date" class="pressure-chart">
            <h2>ğŸ”¹æ°—åœ§é…ç½®å›³ğŸ”¹</h2>
            <p class="font90">â€»å†™çœŸæ’®å½±æ™‚é–“ã«è¿‘ã„ã‚‚ã®ã‚’è¡¨ç¤º</p>
            <img
              :src="getPressureUrl()"
              alt="æ°—åœ§é…ç½®å›³"
              class="pressure-img"
            />
            <p class="right">(æ°—è±¡åºHPã‚ˆã‚Š)</p>
          </div>
        </div>
      </div>
    </main>
    <footer>
      <div class="wrapper">
        <p>&copy; {{ site.time | date: "%Y" }} {{ site.title }}</p>
      </div>
    </footer>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
      const { createApp } = Vue;

      createApp({
          data() {
              return {
                  date: new URLSearchParams(window.location.search).get("date") || "20251114",
                  directions: ["åŒ—", "æ±", "å—", "è¥¿"],
                  currentDir: "åŒ—",
                  comments: {{ site.data.days | jsonify }},
                  baseurl: "{{ site.baseurl }}"
              };
          },
          computed: {
              comment() {
                  return this.comments[this.date]?.comment || "";
              },
              formattedDate() {
                const s = String(this.date || "");
                // æ­£ã—ããªã„å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ï¼ˆã‚‚ã—ãã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã«ã™ã‚‹ï¼‰
                if (!/^\d{8}$/.test(s)) return "";

                const y = parseInt(s.slice(0, 4), 10);
                const m = parseInt(s.slice(4, 6), 10);
                const d = parseInt(s.slice(6, 8), 10);

                // Date(year, monthIndex, day) ã‚’ä½¿ã†ï¼ˆæœˆã¯ 0 é–‹å§‹ï¼‰
                const dt = new Date(y, m - 1, d);

                // Intl.DateTimeFormat ã§æ—¥æœ¬èªè¡¨è¨˜ï¼ˆä¾‹: 2025å¹´11æœˆ14æ—¥(é‡‘)ï¼‰
                return new Intl.DateTimeFormat("ja-JP", {
                    weekday: "short",
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                }).format(dt);
            }
          },
          methods: {
              getPhotoUrl(dir) {
                  const map = { åŒ—: "north", æ±: "east", å—: "south", è¥¿: "west" };
                  return `${this.baseurl}/photos/${this.date}/${map[dir]}.jpg`;
              },
              getPressureUrl() {
                  return `${this.baseurl}/photos/${this.date}/pressure.png`;
              }
          },
          mounted() {
              document.title = `${this.$options.title || 'ã“ã®æ—¥ã®å†™çœŸ'}ï¼š${this.formattedDate} - ä»Šæ—¥ã®ç©ºã‚‚ã‚ˆã†`;
          }
      }).mount("#app");
    </script>
  </body>
</html>
